import requests

WEATHER_CODES = {
    0: "โ ะฏัะฝะพ",
    1: "๐ค ะะพััะธ ััะฝะพ",
    2: "โ ะะตัะตะผะตะฝะฝะฐั ะพะฑะปะฐัะฝะพััั",
    3: "โ ะะฐัะผััะฝะพ",

    45: "๐ซ ะขัะผะฐะฝ",
    48: "๐ซ ะัะฐะถะดะฐััะธะน ะธะฝะตะน",

    51: "๐ฆ ะัะณะบะฐั ะผะพัะพัั",
    53: "๐ฆ ะกัะตะดะฝัั ะผะพัะพัั",
    55: "๐ง ะกะธะปัะฝะฐั ะผะพัะพัั",

    56: "๐ฆ ะะตะดัะฝะฐั ะผะพัะพัั",
    57: "๐ง ะกะธะปัะฝะฐั ะปะตะดัะฝะฐั ะผะพัะพัั",

    61: "๐ฆ ะัะณะบะธะน ะดะพะถะดั",
    63: "๐ง ะะพะถะดั",
    65: "๐ง ะกะธะปัะฝัะน ะดะพะถะดั",

    66: "๐ง ะะตะดัะฝะพะน ะดะพะถะดั",
    67: "๐ง ะกะธะปัะฝัะน ะปะตะดัะฝะพะน ะดะพะถะดั",

    71: "๐จ ะัะณะบะธะน ัะฝะตะณ",
    73: "๐จ ะกะฝะตะณ",
    75: "โ ะกะธะปัะฝัะน ัะฝะตะณ",

    77: "โ ะกะฝะตะถะฝะฐั ะบััะฟะฐ",

    80: "๐ง ะะธะฒะฝะธ (ัะปะฐะฑัะต)",
    81: "๐ง ะะธะฒะฝะธ",
    82: "๐ง ะะธะฒะฝะธ (ัะธะปัะฝัะต)",

    85: "๐จ ะกะฝะตะถะฝัะต ะปะธะฒะฝะธ",
    86: "โ ะกะฝะตะถะฝัะต ะปะธะฒะฝะธ (ัะธะปัะฝัะต)",

    95: "โ ะัะพะทะฐ",
    96: "โ ะัะพะทะฐ ั ะณัะฐะดะพะผ",
    99: "โ ะกะธะปัะฝะฐั ะณัะพะทะฐ ั ะณัะฐะดะพะผ",
}

def get_weather(city: str):
    """ะขะตะบััะฐั ะฟะพะณะพะดะฐ โ ะธัะฟัะฐะฒะปะตะฝะฝะฐั, ัะตะฐะปัะฝะฐั, ะฑะตะท ะทะฐะฒััะตะฝะธะน"""

    # ะะตะพะบะพะดะธะฝะณ
    geo = requests.get(
        f"https://geocoding-api.open-meteo.com/v1/search?name={city}&count=1&language=ru"
    ).json()

    if "results" not in geo:
        return "โ ะะพัะพะด ะฝะต ะฝะฐะนะดะตะฝ."

    lat = geo["results"][0]["latitude"]
    lon = geo["results"][0]["longitude"]

    # ะขะะะฃะฉะะฏ ะะะะะะ (current_weather)
    url = (
        f"https://api.open-meteo.com/v1/forecast?"
        f"latitude={lat}&longitude={lon}"
        f"&current_weather=true"
        f"&timezone=auto"
    )

    data = requests.get(url).json()

    w = data["current_weather"]

    temp = w["temperature"]
    wind = w["windspeed"]
    code = w["weathercode"]
    desc = WEATHER_CODES.get(code, "ะะตะธะทะฒะตััะฝะพ")

    return (
        f"๐ค *ะะพะณะพะดะฐ ัะตะนัะฐั โ {city}:*\n\n"
        f"๐ก ะขะตะผะฟะตัะฐัััะฐ: *{temp}ยฐC*\n"
        f"{desc}\n"
        f"๐จ ะะตัะตั: {wind} ะผ/ั"
    )
